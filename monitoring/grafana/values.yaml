grafana.ini:
  paths:
    data: /var/lib/grafana/
    logs: /var/log/grafana
    plugins: /var/lib/grafana/plugins
    provisioning: /etc/grafana/provisioning
  analytics:
    check_for_updates: true
  log:
    mode: console
  grafana_net:
    url: https://grafana.net
  server:
    domain: grafana.contextsuite.com
    root_url: https://grafana.contextsuite.com
  database:
    type: postgres
    url: $__file{/etc/secrets/csx-secrets/db-url}
    ssl_mode: require

ingress:
  enabled: true
  hosts:
    - grafana.contextsuite.com
  tls:
    - hosts:
        - grafana.contextsuite.com
      secretName: star-contextsuite-com

extraSecretMounts:
  - name: csx-secrets
    mountPath: /etc/secrets/csx-secrets
    secretName: csx-secrets
    readOnly: true
    optional: false

# Mount the Longhorn alerts ConfigMap
extraConfigmapMounts:
  - name: longhorn-alerts
    mountPath: /etc/grafana/provisioning/alerting/rules
    configMap: grafana-longhorn-alerts
    readOnly: true

service:
  annotations:
    tailscale.com/hostname: grafana
    tailscale.com/expose: "true"

# Provisioning alert rules
# dashboardProviders:
#   dashboardproviders.yaml:
#     apiVersion: 1
#     providers:
#       - name: 'default'
#         orgId: 1
#         folder: ''
#         type: file
#         disableDeletion: false
#         editable: true
#         options:
#           path: /var/lib/grafana/dashboards

alerting:
  provisioning:
    folder: 
      name: Alerts
    alertmanagerConfiguration:
      - action: reconcile
        apiVersion: 1
        name: default
    rules:
      - name: default
        type: file
        folder: Alerts
        disableDeletion: false
        allowUiUpdates: true
        options:
          path: /etc/grafana/provisioning/alerting/rules
